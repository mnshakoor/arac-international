<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ARAC Strategic Communications Division</title>
  <style>
    :root {
      --teal: #00b9a1;
      --green: #4CAF50;
      --ink: #0a0a0a;
      --bg: #000000;
      --text: #f5f5f5;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
      background: radial-gradient(circle at 50% 40%, var(--ink), var(--bg));
      color: var(--text);
      overflow: hidden;
    }
    header {
      position: absolute;
      top: 18px;
      left: 50%;
      transform: translateX(-50%);
      text-align: center;
      z-index: 10;
      padding: 0 12px;
      user-select: none;
      pointer-events: none;
    }
    header img { width: 220px; max-width: 60vw; filter: drop-shadow(0 2px 12px rgba(0,0,0,.5)); }
    header h1 { margin: 10px 0 0; color: var(--teal); font-weight: 700; letter-spacing: .3px; }
    header p { margin: 6px 0 0; opacity: .9; }

    canvas { display: block; width: 100vw; height: 100vh; }

    .links {
      position: absolute; bottom: 34px; left: 50%; transform: translateX(-50%);
      width: 100%; max-width: 1200px; padding: 0 12px; text-align: center; z-index: 5;
    }
    .links a {
      display: inline-block; margin: 6px 8px; padding: 10px 14px 11px;
      background: var(--teal); color: #00110d; text-decoration: none;
      border-radius: 8px; font-weight: 700; letter-spacing: .2px; transition: transform .15s ease, background .2s ease;
      box-shadow: 0 6px 20px rgba(0,185,161,.18);
    }
    .links a:hover { background: var(--green); transform: translateY(-1px); }

    /* Tiny helper label for load state */
    #status { position: absolute; top: 10px; left: 10px; font-size: 12px; opacity: .7; z-index: 15; }
  </style>
</head>
<body>
  <div id="status">loading…</div>
  <header>
    <img src="IMG_0868.PNG" alt="ARAC Logo" />
    <h1>Strategic Communications Division</h1>
    <p>Data Journalism & Analytical Communications for Peace and Security</p>
  </header>

  <canvas id="network" aria-label="Animated partner network visualization"></canvas>

  <div class="links" aria-label="Primary navigation">
    <a href="https://newsletter.arac-international.org" target="_blank" rel="noopener">Newsletter & Flashpoints</a>
    <a href="https://afsdata.net" target="_blank" rel="noopener">Data Journalism</a>
    <a href="https://gsn-app.arac-international.org" target="_blank" rel="noopener">Global Security News</a>
    <a href="https://quanta-analytica.mnshakoor.com" target="_blank" rel="noopener">Quanta Analytica</a>
    <a href="https://quanta-analytica.mnshakoor.com/resources" target="_blank" rel="noopener">Resources</a>
    <a href="https://mns-consulting.b12sites.com/index" target="_blank" rel="noopener">MNS Consulting</a>
  </div>

  <script>
    // --- Canvas bootstrap with HiDPI support ---
    const canvas = document.getElementById('network');
    const ctx = canvas.getContext('2d');
    const DPR = Math.max(1, Math.floor(window.devicePixelRatio || 1));

    function resizeCanvas() {
      const { innerWidth:w, innerHeight:h } = window;
      canvas.width = w * DPR;
      canvas.height = h * DPR;
      canvas.style.width = w + 'px';
      canvas.style.height = h + 'px';
      ctx.setTransform(DPR, 0, 0, DPR, 0, 0); // scale drawing operations
    }
    resizeCanvas();

    // --- Particle field (network-y background) ---
    const nodes = [];
    const NODE_COUNT = 46;
    for (let i = 0; i < NODE_COUNT; i++) {
      nodes.push({
        x: Math.random() * window.innerWidth,
        y: Math.random() * window.innerHeight,
        vx: (Math.random() - 0.5) * 0.7,
        vy: (Math.random() - 0.5) * 0.7,
        r: Math.random() * 1.8 + 0.9
      });
    }

    // --- Partner icon sources (filenames are case-sensitive on GitHub Pages) ---
    const IMAGE_SOURCES = [
      'arac-stratcom.PNG',
	'IOSI logo black-white.PNG',
      'logo-mns2-seal.png',
      'digital-navigator.PNG',
	'iosi-mforce.PNG',
	'srmp-c-seal.PNG',
      'inssa.PNG',
	'iep.PNG',
	'the-sovereign-observer.png',
	'usidhr-badge.PNG',
	'arac-data.PNG',
	'lbs-gsc.PNG',
      'usidhr-hr-badge.PNG' // ARAC logo (also drawn in center)
    ];

    // Preload images safely – only draw after they are fully loaded
    function loadImages(srcs) {
      return Promise.all(srcs.map(src => new Promise(resolve => {
        const img = new Image();
        img.decoding = 'async';
        img.onload = () => resolve({ ok: true, img, src });
        img.onerror = () => resolve({ ok: false, img: null, src });
        img.src = src;
      })));
    }

    // Draw helper for a rounded placeholder if an icon fails to load
    function drawPlaceholder(x, y, size, label) {
      ctx.save();
      ctx.beginPath();
      ctx.arc(x, y, size/2, 0, Math.PI * 2);
      ctx.fillStyle = 'rgba(0,185,161,.15)';
      ctx.fill();
      ctx.lineWidth = 2;
      ctx.strokeStyle = 'rgba(0,185,161,.6)';
      ctx.stroke();
      ctx.fillStyle = 'rgba(245,245,245,.85)';
      ctx.font = '600 10px system-ui, sans-serif';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText(label || 'N/A', x, y);
      ctx.restore();
    }

    // main animation loop – starts only when images are ready
    function start(icons) {
      const status = document.getElementById('status');
      status.textContent = 'ready';
      setTimeout(() => status.remove(), 1200);

      let last = 0;
      function frame(ts) {
        // throttle to ~60fps automatically by rAF
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // --- animated particle network ---
        for (let i = 0; i < nodes.length; i++) {
          const n = nodes[i];
          n.x += n.vx; n.y += n.vy;
          if (n.x < 0 || n.x > window.innerWidth) n.vx *= -1;
          if (n.y < 0 || n.y > window.innerHeight) n.vy *= -1;

          ctx.beginPath();
          ctx.arc(n.x, n.y, n.r, 0, Math.PI * 2);
          ctx.fillStyle = '#00B9A1';
          ctx.fill();
        }
        for (let i = 0; i < nodes.length; i++) {
          for (let j = i + 1; j < nodes.length; j++) {
            const dx = nodes[i].x - nodes[j].x;
            const dy = nodes[i].y - nodes[j].y;
            const d = Math.hypot(dx, dy);
            if (d < 150) {
              ctx.strokeStyle = `rgba(0,185,161,${1 - d / 150})`;
              ctx.lineWidth = 0.5;
              ctx.beginPath();
              ctx.moveTo(nodes[i].x, nodes[i].y);
              ctx.lineTo(nodes[j].x, nodes[j].y);
              ctx.stroke();
            }
          }
        }

        // --- center ARAC emblem ---
        const cx = window.innerWidth / 2;
        const cy = window.innerHeight / 2;
        const centerSize = 110;
        const center = icons.find(it => it.src.endsWith('IMG_0868.PNG')) || icons[0];
        if (center && center.ok && center.img && center.img.complete && center.img.naturalWidth > 0) {
          ctx.save();
          ctx.beginPath();
          ctx.arc(cx, cy, centerSize/2, 0, Math.PI * 2);
          ctx.closePath();
          ctx.clip();
          ctx.drawImage(center.img, cx - centerSize/2, cy - centerSize/2, centerSize, centerSize);
          ctx.restore();
        } else {
          drawPlaceholder(cx, cy, centerSize, 'ARAC');
        }

        // --- orbiting partner icons ---
        const RADIUS = Math.min(250, Math.max(170, Math.min(window.innerWidth, window.innerHeight) / 3));
        const time = performance.now() * 0.00025; // speed
        const size = 70;
        const step = (Math.PI * 2) / icons.length;
        icons.forEach((it, i) => {
          const ang = time + i * step;
          const x = cx + RADIUS * Math.cos(ang);
          const y = cy + RADIUS * Math.sin(ang);

          if (it.ok && it.img && it.img.complete && it.img.naturalWidth > 0) {
            ctx.save();
            ctx.beginPath();
            ctx.arc(x, y, size/2, 0, Math.PI * 2);
            ctx.closePath();
            ctx.clip();
            ctx.drawImage(it.img, x - size/2, y - size/2, size, size);
            ctx.restore();
          } else {
            // Label from filename
            const label = (it.src.split('/') .pop() || 'logo').split('.')[0].slice(0, 8);
            drawPlaceholder(x, y, size, label);
          }
        });

        requestAnimationFrame(frame);
      }
      requestAnimationFrame(frame);
    }

    // Load and then start the animation
    loadImages(IMAGE_SOURCES).then(results => {
      // Filter to keep order but mark ok/failed
      const icons = results.map(r => ({ ok: r.ok, img: r.img, src: r.src }));

      // --- simple runtime checks ("test cases") ---
      console.assert(icons.length === IMAGE_SOURCES.length, 'Test: all sources processed');
      const loadedCount = icons.filter(i => i.ok).length;
      console.assert(loadedCount > 0, 'Test: at least one image loaded successfully');

      // Log any failures to help debug missing filenames/case sensitivity on GitHub Pages
      icons.forEach(i => { if (!i.ok) console.warn('Image failed to load (check filename/case):', i.src); });

      start(icons);
    });

    // Redraw at correct resolution when the window size changes
    window.addEventListener('resize', () => {
      resizeCanvas();
    });
  </script>
</body>
</html>
